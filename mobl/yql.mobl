module mobl::yql

service YQL {
  resource query(q : String) : JSON {
    method = "GET"
    encoding = "jsonp"
    uri = "http://query.yahooapis.com/v1/public/yql?q=" + escape(q) + "&format=json"
    mapper = yqlMapper
  }
}

function yqlMapper(result : JSON) : JSON {
  if(result.error) {
    return result;
  } else {
    return result.query.results;
  }
}